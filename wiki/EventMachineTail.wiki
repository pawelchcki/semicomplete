#summary File tailing with EventMachine

= Introduction =

eventmachine-tail implements file tailing with EventMachine.

== Why? ==

For [http://code.google.com/p/logstash/ logstash], the log agents were
event-driven using EventMachine. The log agents mainly get their data from
logfiles. To that end, we needed a way to treat log files as a stream.

There's a ruby gem 'file-tail' that implements tailing, but not in an
event-driven way. This makes it hard to use in EventMachine programs.

Thus, eventmachine-tail was born.

Further, the usage patterns for logstash required the ability to watch a
directory (or a file pattern) for new log files.

= Implementation Details = 

== "Don't block the reactor" ==

EventMachine::FileTail will only read one chunk (64K by default) from any file
for each tick of the reactor. This helps ensure we don't spend too much time 
reading from the file.

A consequence of not reading the file "as fast as possible until eof" can cause
longer data sets to take longer to read since there will be a small delay
between each read since the reactor only runs about once every 50ms (depending
on the polling features used).

== EOF Handling ==

When we are at the end of file, we rely on EventMachine::FileWatch to notify us
when the file changes. On Linux this uses inotify and on OS X and FreeBSD will
use kqueue to get event-driven notifications of file.

== File truncation ==

If the file length ever shortens, we assume this means the file was truncated.
When this happens, we seek to the beginning of the file and continue reading.

== File rotation ==

If we notice that the inode (or underlying device) has changed, we will reopen
the file by pathname. This change is generally an indication that our file has
been rotated as part of some periodic log rotation.

== Globs ==

You can also use file [http://en.wikipedia.org/wiki/Glob_(programming) glob patterns]
to select files to tail. This pattern is checked periodically to see if new
files are found. 

For example, if your java app writes to logfiles with generated filenames that
are hard to predict, you should use EventMachine::FileGlobWatch to match any
generated files as they are generated.

= Sample Code =

   * [http://code.google.com/p/semicomplete/source/browse/eventmachine-tail/samples/tail.rb simple tail example]
   * [http://code.google.com/p/semicomplete/source/browse/eventmachine-tail/samples/glob-tail.rb glob tailing example]
